<!DOCTYPE html>
<html>
<head>
  <title>Cameroon Post-Election Unrest: Bubble Plot by City (11 Events, Oct 13-17, 2025)</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map {
      height: 100vh;
      width: 100%;
      max-width: 100vw;
      margin: 0;
      padding: 0;
    }
    .leaflet-tooltip {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #333;
      padding: 5px;
      font-size: 12px;
      max-width: 150px;
    }
    .table-control {
      background: white;
      padding: 10px;
      border: 1px solid #333;
      max-height: 50vh;
      overflow-y: auto;
      font-size: 12px;
      position: relative;
      z-index: 1000;
      -webkit-tap-highlight-color: transparent; /* Remove tap highlight */
    }
    .table-control button {
      margin-bottom: 5px;
      padding: 5px 10px;
      width: 100%;
      font-size: 14px;
    }
    .table-control table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    .table-control thead {
      position: sticky;
      top: 0;
      background: #f2f2f2;
      z-index: 1;
    }
    .table-control th, .table-control td {
      border: 1px solid #ddd;
      padding: 2px 4px;
      text-align: left;
      word-wrap: break-word;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .table-control th {
      position: sticky;
      top: 0;
    }
    .table-wrapper {
      max-height: 45vh;
      overflow-x: auto;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      min-width: 100%;
      touch-action: manipulation; /* Enable immediate touch scrolling */
    }

    /* Media Queries for Mobile */
    @media (max-width: 768px) {
      #map {
        height: 60vh;
      }
      .table-control {
        max-height: 60vh;
        width: 90vw;
        margin: 0 auto;
      }
      .table-control table {
        min-width: 800px;
      }
      .table-control th, .table-control td {
        font-size: 8px;
        padding: 1px 2px;
      }
      .leaflet-tooltip {
        font-size: 10px;
        max-width: 100px;
      }
      .table-control button {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    const map = L.map('map').setView([6.0, 12.0], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    L.control.scale().addTo(map);

    // City data with corrected Bamenda coordinates
    const cityData = [
      [9.30, 13.40, 'Garoua', 2, '2, 2', 'Oct 13, Oct 17', 2],
      [4.05, 9.70, 'Douala', 4, '1, 2, 4, 4', 'Oct 14, 15, 16, 17', 4],
      [3.87, 11.52, 'Yaoundé', 1, '1', 'Oct 15', 1],
      [5.40, 10.45, 'Dschang', 1, '3', 'Oct 16', 3],
      [4.00, 9.25, 'Limbe', 1, '1', 'Oct 16', 1],
      [10.95, 14.45, 'Makary', 1, '1', 'Oct 16', 1],
      [5.96, 10.15, 'Bamenda', 1, '1', 'Oct 17', 1]
    ];

    const colors = {1: 'green', 2: 'yellow', 3: 'yellow', 4: 'red', 5: 'red'};
    const baseRadius = 15000;

    const circles = [];

    function updateBubbleSizes() {
      const zoom = map.getZoom();
      const scaleFactor = 6 / zoom;
      cityData.forEach(function(data, index) {
        const adjustedRadius = baseRadius * scaleFactor;
        if (circles[index]) {
          circles[index].setRadius(adjustedRadius);
        }
      });
    }

    cityData.forEach(function(data, index) {
      const color = colors[data[6]] || 'blue';
      const circle = L.circle([data[0], data[1]], {
        radius: baseRadius,
        color: color,
        fillColor: color,
        fillOpacity: 0.6,
        weight: 2
      })
      .addTo(map)
      .bindTooltip(
        `${data[2]}: ${data[3]} Events, Severities: ${data[4]}, Dates: ${data[5]}`,
        { permanent: false, direction: 'top', className: 'leaflet-tooltip' }
      );
      circles.push(circle);
    });

    map.on('zoomend', updateBubbleSizes);
    updateBubbleSizes();

    L.Control.TableControl = L.Control.extend({
      onAdd: function(map) {
        const container = L.DomUtil.create('div', 'table-control');
        const button = L.DomUtil.create('button', '', container);
        button.innerHTML = 'Toggle Table';
        let tableVisible = false;

        const tableWrapper = L.DomUtil.create('div', 'table-wrapper', container);
        const table = L.DomUtil.create('table', '', tableWrapper);
        const thead = L.DomUtil.create('thead', '', table);
        const tbody = L.DomUtil.create('tbody', '', table);
        const headers = ['Date', 'City/Town', 'Province/Region', 'Est. Participants', 'Duration', 'Est. Police Size', 'Est. Material Damage (CFA)', 'Reported Deaths', 'Injuries Reported', 'Arrests Made', 'Trigger Event', 'Resolution Status', 'Local Leaders Involved', 'Economic Impact (Broader, CFA)', 'Social Media Mentions (X/FB/TT)', 'New Severity Score'];
        const headerRow = L.DomUtil.create('tr', '', thead);
        headers.forEach(header => {
          const th = L.DomUtil.create('th', '', headerRow);
          th.innerHTML = header;
          th.style.width = (100 / headers.length) + '%';
        });

        const tableData = [
          ['October 13', 'Garoua', 'North', '200-300', '2-3 hours', '50-100 (gendarmes)', '~5M', '0', '5', '0', 'Early vote tally discrepancies', 'Standoff; tensions eased overnight', 'Local opposition coordinators', '~2M', '150 / 100 / 200', '2'],
          ['October 14', 'Douala (general)', 'Littoral', '80-150', '1 hour', '80+ (riot police)', 'N/A', '0', '1', '5-10', 'Tchiroma\'s initial victory claim', 'Dispersed with warnings', 'Youth activists (Gen Z groups)', '~2M', '150 / 100 / 200', '1'],
          ['October 15', 'Douala (Bonamoussadi)', 'Littoral', '120-250', '1-2 hours', '120+ (riot police)', 'N/A', '0', '3', '14', 'ELECAM tampering allegations', 'Dispersed violently', 'Youth demonstrators & moto-taximen leaders', '~4M', '250 / 200 / 300', '2'],
          ['October 15', 'Yaoundé', 'Centre', '50-100', '~1 hour', '50-75 (police)', 'N/A', '0', '1', '2', 'ELECAM tally delays', 'Dispersed quickly', 'MRC sympathizers', 'N/A', '100 / 80 / 150', '1'],
          ['October 16', 'Douala (Boadibo)', 'Littoral', '300-500', '3-4 hours', '150+ (anti-riot)', '~20M', '0', '10', '20-30', 'Fraud petitions filed', 'Dispersed; office damaged', 'Local chiefs', '~10M', '400 / 300 / 500', '4'],
          ['October 16', 'Dschang', 'West', '150-250', '2 hours', '75-100 (gendarmes)', '~10M', '0', '3', '5-10', 'CPDM office arson rumors', 'Mediated', 'Community elders', '~4M', '250 / 200 / 350', '3'],
          ['October 16', 'Limbe', 'Southwest', '50-100', '1 hour', 'Minimal (10-20)', '~3M', '0', '0', '0', 'Anglophone solidarity calls', 'Symbolic', 'Separatist sympathizers', '~1M', '120 / 100 / 200', '1'],
          ['October 16', 'Makary', 'Far North', '100-150', '2 hours', '30-50 (local)', '~1M', '0', '0', '0', 'Northern vote leads disputed', 'Mediated', 'Local imams', 'N/A', '80 / 60 / 100', '1'],
          ['October 16', 'Douala (Boadibo, cont.)', 'Littoral', '200-400', '4 hours', '200+ (reinforced)', '~5M', '0', '8', '15-25', 'Continued fraud leaks', 'Dispersed with force', 'Youth leaders', '~8M', '300 / 250 / 400', '4'],
          ['October 17', 'Garoua (residence)', 'North', '300-500', 'Ongoing', '100-150 (gendarmes)', 'N/A', '0', '5', '0', 'Tchiroma\'s Facebook Live', 'Ongoing standoff', 'Tchiroma allies', '~3M', '200 / 150 / 250', '2'],
          ['October 17', 'Bamenda', 'Northwest', '50-100', '1-2 hours', '20-40 (patrols)', 'N/A', '0', '0', '0', 'Separatist boycott solidarity', 'Symbolic', 'Ambazonia groups', 'N/A', '100 / 80 / 150', '1']
        ];

        tableData.forEach(row => {
          const tr = L.DomUtil.create('tr', '', tbody);
          row.forEach(cell => {
            const td = L.DomUtil.create('td', '', tr);
            td.innerHTML = cell;
            td.style.width = (100 / headers.length) + '%';
          });
        });

        table.style.display = 'none';

        button.onclick = function() {
          tableVisible = !tableVisible;
          table.style.display = tableVisible ? 'block' : 'none';
          button.innerHTML = tableVisible ? 'Hide Table' : 'Show Table';
        };

        return container;
      },
      onRemove: function(map) {
        // Nothing to do on removal
      }
    });

    L.control.tableControl = function(opts) {
      return new L.Control.TableControl(opts);
    };

    L.control.tableControl({ position: 'bottomright' }).addTo(map);

    L.control({ position: 'topright' }).addTo(map).getContainer().innerHTML = `
      <div style="background: white; padding: 10px; border: 1px solid #333;">
        <h4>Cameroon Unrest by City (11 Events, Oct 13-17, 2025)</h4>
      </div>
    `;
  </script>
</body>
</html>
